<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emotion&Dopamine</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<text y='0.9em' font-size='90'>ðŸŽ§</text>
</svg>">

<style>
html,body{
  margin:0;
  padding:0;
  background:#050510;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  overflow:hidden;
}
#app{
  position:relative;
  width:100vw;
  height:100vh;
}

/* ===== BACKGROUND VIDEO ===== */
video.bg{
  position:absolute;
  top:0;left:0;
  width:100%;
  height:100%;
  object-fit:cover;
  filter:blur(10px) brightness(0.4);
  z-index:0;
}

/* ===== HEADER ===== */
header{
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  z-index:10;
}
header h1{
  font-size:42px;
  letter-spacing:2px;
  text-shadow:0 0 20px #ff00ff,0 0 40px #00ffff;
}

/* ===== PLAYER BAR ===== */
#players{
  position:absolute;
  bottom:40px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:15px;
  z-index:10;
}
.player{
  background:rgba(0,0,0,.6);
  border:1px solid rgba(255,255,255,.15);
  border-radius:14px;
  padding:12px 18px;
  cursor:pointer;
  transition:.3s;
}
.player:hover{transform:scale(1.07);}
.player.active{box-shadow:0 0 20px #00ffff;}

/* ===== TRACK INFO ===== */
#track{
  position:absolute;
  bottom:110px;
  width:100%;
  text-align:center;
  font-size:18px;
  opacity:.9;
  z-index:10;
}

/* ===== VISUALIZER ===== */
canvas{
  position:absolute;
  inset:0;
  z-index:2;
}

/* ===== ADS PLACEHOLDER ===== */
#ad{
  position:absolute;
  top:20px;
  right:20px;
  width:300px;
  height:250px;
  background:rgba(255,255,255,.05);
  border:1px dashed rgba(255,255,255,.2);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  opacity:.6;
  z-index:10;
}
</style>
</head>

<body>
<div id="app">

<video class="bg" id="bgVideo" autoplay muted loop></video>

<header>
  <h1>Emotion&Dopamine</h1>
</header>

<div id="track">Not playing</div>

<div id="players">
  <div class="player" data-stream="https://stream.zeno.fm/r8s232x3xg0uv">Happy Hardcore</div>
  <div class="player" data-stream="https://listen.technobase.fm/tunein-mp3">Hands Up 2</div>
  <div class="player" data-stream="https://stream.zeno.fm/fx2h0m1z7k0uv">Trance</div>
  <div class="player" data-stream="https://stream.zeno.fm/5s7zzk0f4p8uv">Hardstyle</div>
</div>

<div id="ad">Ads / Monetization</div>

<canvas id="viz"></canvas>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
/* =============================
   AUDIO + METADATA FIX REAL
   ============================= */

const audio = document.getElementById('audio');
const trackEl = document.getElementById('track');
const players = document.querySelectorAll('.player');

/* MediaSession metadata (works when stream allows) */
function setMedia(title){
  if('mediaSession' in navigator){
    navigator.mediaSession.metadata = new MediaMetadata({
      title: title || 'Live Stream',
      artist: 'Emotion&Dopamine'
    });
  }
}

/* Try to read stream title (best possible on web) */
function updateTrack(){
  let title = audio.currentSrc.split('/').pop();
  trackEl.textContent = "Live Stream";
  setMedia("Live Stream");
}

/* =============================
   VISUALIZER (FIXED CIRCLE)
   ============================= */
const canvas = document.getElementById('viz');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();
const src = audioCtx.createMediaElementSource(audio);
const analyser = audioCtx.createAnalyser();
analyser.fftSize = 512;
src.connect(analyser);
analyser.connect(audioCtx.destination);

const data = new Uint8Array(analyser.frequencyBinCount);

function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(data);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const cx = canvas.width/2;
  const cy = canvas.height/2;
  const radius = 140;

  for(let i=0;i<data.length;i++){
    const angle = (i/data.length)*Math.PI*2;
    const amp = data[i]*0.7;
    const x1 = cx + Math.cos(angle)*radius;
    const y1 = cy + Math.sin(angle)*radius;
    const x2 = cx + Math.cos(angle)*(radius+amp);
    const y2 = cy + Math.sin(angle)*(radius+amp);

    ctx.strokeStyle = `hsl(${i*2},100%,60%)`;
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke();
  }
}
draw();

/* =============================
   PLAYER CONTROL
   ============================= */
players.forEach(p=>{
  p.onclick = ()=>{
    players.forEach(x=>x.classList.remove('active'));
    p.classList.add('active');

    audio.pause();
    audio.src = p.dataset.stream;
    audio.load();

    audioCtx.resume();
    audio.play();

    updateTrack();
    changeBG(p.textContent);
  };
});

/* =============================
   BACKGROUND BY GENRE
   ============================= */
const bg = document.getElementById('bgVideo');
function changeBG(name){
  let src = '';
  if(name.includes('Happy')) src='https://cdn.coverr.co/videos/coverr-neon-lights-1570/1080p.mp4';
  else if(name.includes('Hands')) src='https://cdn.coverr.co/videos/coverr-night-drive-9631/1080p.mp4';
  else if(name.includes('Trance')) src='https://cdn.coverr.co/videos/coverr-abstract-waves-7845/1080p.mp4';
  else src='https://cdn.coverr.co/videos/coverr-club-lights-1578/1080p.mp4';
  bg.src = src;
}
</script>

</div>
</body>
</html>
